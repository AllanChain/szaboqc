name: Build

on:
  push:
    branches:
      - master

  pull_request:
    branches:
      - master

env:
  CTAN_URL: https://mirrors.rit.edu/CTAN
  TL_PACKAGES: amsmath amssymb amsthm anyfontsize blkarray bm booktabs braket calc caption ctex endnotes enumerate fancyhdr float graphicx hyperref indentfirst latexmk mathalfa mathpazo mathptmx mathtools needspace scalerel siunitx stackengine tabularx threeparttable tikz pgfplots ulem wasysym xeCJKfntef xcolor xparse
  #alphalph auxhook biber biblatex biblatex-gb7714-2015 bigfoot blindtext cleveref cm-unicode csquotes dashundergaps emptypage enumitem fancyvrb fandol footmisc grfext hologo hycolor hypdoc l3build libertinus-fonts listings lua-ul lualatex-math luatex85 makecell makeindex newcomputermodern ninecolors ntheorem pict2e preview psnfss setspace standalone symbol tabularray tex-gyre tex-gyre-math translator underscore unicode-math xits xstring zref

jobs:
  build-on-ubuntu:
    runs-on: ubuntu-latest
    if: "!startsWith(github.ref, 'refs/tags/v')"
    env:
      SET_PATH: |
        export PATH=/tmp/texlive/bin/x86_64-linux:$PATH
    steps:
      - name: Set up Git repository
        uses: actions/checkout@v2

      - name: Install TeX Live
        run: |
          ${{ env.SET_PATH }}
          wget ${{ env.CTAN_URL }}/systems/texlive/tlnet/install-tl-unx.tar.gz
          tar -xzf install-tl-unx.tar.gz
          cd install-tl-20* && ./install-tl --profile ../.github/workflows/texlive.profile
          tlmgr install ${{ env.TL_PACKAGES }}
          tlmgr update --self --all --no-auto-install --repository=${{ env.CTAN_URL }}/systems/texlive/tlnet/
      - name: Compile test file
        run: |
          ${{ env.SET_PATH }}
          #cd test
          latexmk -xelatex  -halt-on-error test-xetex-undergraduate
      - name: Upload PDF
        uses: actions/upload-artifact@v2
        with:
          name: generated-pdf
          path:
            /*.pdf
